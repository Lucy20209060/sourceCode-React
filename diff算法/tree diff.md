React对树的算法进行了简洁明了的优化 即对树进行分层比较 两棵树只会对同一层次的节点进行比较

React通过updateDepth对Virtual DOM树进行层级控制 只会对相同层级的DOM节点进行比较 即同一父节点下的所有子节点 当发现子节点已经不存在时 则该节点及其子节点被完全删除 不会用于比较 这样只需要对树进行一次遍历 便完成整个DOM树的比较

如果DOM节点跨层级的移动操作

            R                                   R
        ____|____                               |____
        |       |                                    |
        A       D       ---------------->            D
    ____|____                                        |
    |       |                                        A
    B       C                                    ____|____
                                                 |       |
                                                 B       C
                        DOM层级变换

A节点及其子节点整个被已到了D节点下 由于React只会简单的考虑同层级节点的位置变换 而对于不同层级的节点 只会创建和删除 当根节点发现子节点A消失了 就会直接销毁A 当D发现多了一个子节点A 则会创建A（及其子节点）作为其子节点 此时 diff的执行请情况是

create A -> create B -> create C -> delete A

由此 当出现节点跨层级移动时 并不会出现移动操作 而是以A节点的整个树被创建 这是一种影响性能的操作 因此官方不建议进行DOM节点跨层级操作

在组件开发中 保持稳定的DOM结构会有助于性能的提升 例如可以通过css的隐藏或显示节点 而不是真正的移除或添加DOM节点